<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>ExpectAsync.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptASDoc">/**
 * Copyright (c) 2009 Digital Primates IT Consulting Group
 * 
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 * 
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 * 
 * @author     Michael Labriola 
 * @version    
 **/</span> 
<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">flexunit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">internals</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">runners</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">statements</span> <span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Event</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">net</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Responder</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Dictionary</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PropertyChangeEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rpc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">IResponder</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">flexunit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Assert</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">flexunit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">AssertionError</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">flexunit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">async</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">AsyncHandler</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">flexunit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">async</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">AsyncLocator</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">flexunit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">async</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">AsyncNativeTestResponder</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">flexunit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">async</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">AsyncTestResponder</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">flexunit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">async</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">IAsyncTestResponder</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">flexunit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">async</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ITestResponder</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">flexunit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">AsyncEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">flexunit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">AsyncResponseEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">flexunit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">internals</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">flexunit_internal</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">flexunit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">runners</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FrameworkMethod</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">flexunit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">runners</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TestClass</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">flexunit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">token</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">AsyncTestToken</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">flexunit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">token</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ChildResult</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">flexunit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ClassNameUtil</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">fluint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sequence</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SequenceBindingWaiter</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">fluint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sequence</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SequenceRunner</span>;
    
    <span class="ActionScriptReserved">use</span> <span class="ActionScriptReserved">namespace</span> <span class="ActionScriptDefault_Text">flexunit_internal</span>;
    
    <span class="ActionScriptASDoc">/**
     * The &lt;code&gt;ExpectAsync&lt;/code&gt; is a decorator that is responsible for determing 
     * whether a specific test method is expecting an asynchronous response.  As this 
     * infrastructure carries overhead, we only create it when the user specifics a 
     * given test is asynchronous.  The class implements &lt;code&gt;IAsyncHandlingStatement&lt;/code&gt; 
     * and works with the &lt;code&gt;Async&lt;/code&gt; class.&lt;br/&gt;
     * 
     * In order to expect an asynchronous response, a test method must include metadata indicating 
     * it is expecting asynchronous functionality.&lt;br/&gt;
     * 
     * &lt;pre&gt;&lt;code&gt;
     * [Test(async)]
     * public function asyncTest():void {
     *     //Test with asynchronous functionality
     * }
     * &lt;/code&gt;&lt;/pre&gt;
     * 
     * @see org.flexunit.async.Async
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">ExpectAsync</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">AsyncStatementBase</span> <span class="ActionScriptReserved">implements</span> <span class="ActionScriptDefault_Text">IAsyncStatement</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">IAsyncHandlingStatement</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptASDoc">/**
         * @private
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">objectUnderTest</span>:<span class="ActionScriptDefault_Text">Object</span>;
        <span class="ActionScriptASDoc">/**
         * @private
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">statement</span>:<span class="ActionScriptDefault_Text">IAsyncStatement</span>;
        <span class="ActionScriptASDoc">/**
         * @private
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">returnMessageSent</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        
        <span class="ActionScriptASDoc">/**
         * @private
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">testComplete</span>:<span class="ActionScriptDefault_Text">Boolean</span>;
        <span class="ActionScriptASDoc">/**
         * @private
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pendingAsyncCalls</span>:<span class="ActionScriptDefault_Text">Array</span>;
        <span class="ActionScriptASDoc">/**
         * @private
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">asyncFailureConditions</span>:<span class="ActionScriptDefault_Text">Dictionary</span>;
        
        <span class="ActionScriptASDoc">/**
         * @private
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">methodBodyExecuting</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        
        <span class="ActionScriptASDoc">/**
         * Returns a Boolean value indicating whether the test method is current executing.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">bodyExecuting</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">methodBodyExecuting</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Returns a Boolean value indicating whether there are still any pending asynchronous calls.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">hasPendingAsync</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">pendingAsyncCalls</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Attempts to call the provided &lt;code&gt;method&lt;/code&gt; with the provided &lt;code&gt;rest&lt;/code&gt; parameters.
         * 
         * @param method The Function to call with the provided &lt;code&gt;rest&lt;/code&gt; parameters.
         * @param rest The parameters supplied to the &lt;code&gt;method&lt;/code&gt;.
         */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">protect</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">method</span>:<span class="ActionScriptDefault_Text">Function</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">...</span> <span class="ActionScriptDefault_Text">rest</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">try</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">rest</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">rest</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">&gt;</span>0 <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">apply</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">rest</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">method</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">hasPendingAsync</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span> 
                    <span class="ActionScriptDefault_Text">startAsyncTimers</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>; 
                <span class="ActionScriptBracket/Brace">}</span> 
            
            <span class="ActionScriptBracket/Brace">}</span> 
            <span class="ActionScriptReserved">catch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">error</span>:<span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">sendComplete</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">error</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Removes asynchronous event listeners from the provided &lt;code&gt;asyncHandler&lt;/code&gt;.
         * 
         * @param asyncHandler The &lt;code&gt;AsyncHandler&lt;/code&gt; from which to remove the event listeners.
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeAsyncEventListeners</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">asyncHandler</span>:<span class="ActionScriptDefault_Text">AsyncHandler</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">AsyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">EVENT_FIRED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">handleAsyncEventFired</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">AsyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TIMER_EXPIRED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">handleAsyncTimeOut</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span> <span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Removes asynchronous error event listeners from the provided &lt;code&gt;asyncHandler&lt;/code&gt;.
         * 
         * @param asyncHandler The &lt;code&gt;AsyncHandler&lt;/code&gt; from which to remove the error event listeners.
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeAsyncErrorEventListeners</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">asyncHandler</span>:<span class="ActionScriptDefault_Text">AsyncHandler</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">AsyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">EVENT_FIRED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">handleAsyncErrorFired</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">AsyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TIMER_EXPIRED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">handleAsyncTimeOut</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span> <span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * 
         * 
         * 
         * @internal TODO:: This needs to be cleaned up and revised... just a prototype
         * @param eventHandler
         * @param timeout
         * @param passThroughData
         * @param timeoutHandler
         * 
         * @throws Error Test Completed, but additional async event added
         * 
         * @return 
         * 
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">asyncErrorConditionHandler</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">eventHandler</span>:<span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">testComplete</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">sendComplete</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"Test Completed, but additional async event added"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">asyncHandler</span>:<span class="ActionScriptDefault_Text">AsyncHandler</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AsyncHandler</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">eventHandler</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">AsyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">EVENT_FIRED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">handleAsyncErrorFired</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//asyncHandler.addEventListener( AsyncHandler.TIMER_EXPIRED, handleAsyncTimeOut, false, 0, true );
</span>
            <span class="ActionScriptDefault_Text">asyncFailureConditions</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">asyncHandler</span> <span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>; 

            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleEvent</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Creates an &lt;code&gt;AsyncHandler&lt;/code&gt; that pend and either call the &lt;code&gt;eventHandler&lt;/code&gt; or the
         * &lt;code&gt;timeoutHandler&lt;/code&gt;, passing the &lt;code&gt;passThroughData&lt;/code&gt;, depending on whether the
         * &lt;code&gt;timeout&lt;/code&gt; period has been reached.
         * 
         * @param eventHandler The Function that will be executed if the handler is called before 
         * the &lt;code&gt;timeout&lt;/code&gt; has expired.
         * @param timeout The length of time, in milliseconds, before the &lt;code&gt;timeoutHandler&lt;/code&gt; will be executed.
         * @param passThroughData An Object that can be given information about the current test; this information will 
         * be available for both the &lt;code&gt;eventHandler&lt;/code&gt; and the &lt;code&gt;timeoutHandler&lt;/code&gt;.
         * @param timeoutHandler The Function that will be executed if the &lt;code&gt;timeout&lt;/code&gt; time is reached prior to
         * the expected event being dispatched.
         * 
         * @return an event handler Function that will determine whether the &lt;code&gt;timeout&lt;/code&gt; has been reached.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">eventHandler</span>:<span class="ActionScriptDefault_Text">Function</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">timeout</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">passThroughData</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">timeoutHandler</span>:<span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptBracket/Brace">{</span> 
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">testComplete</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">sendComplete</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"Test Completed, but additional async event added"</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">asyncHandler</span>:<span class="ActionScriptDefault_Text">AsyncHandler</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AsyncHandler</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">eventHandler</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">timeout</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">passThroughData</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">timeoutHandler</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">AsyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">EVENT_FIRED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">handleAsyncEventFired</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">AsyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TIMER_EXPIRED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">handleAsyncTimeOut</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span> <span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">pendingAsyncCalls</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">asyncHandler</span> <span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleEvent</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">// We have a toggle in the compiler arguments so that we can choose whether or not the flex classes should
</span>        <span class="ActionScriptComment">// be compiled into the FlexUnit swc.  For actionscript only projects we do not want to compile the
</span>        <span class="ActionScriptComment">// flex classes since it will cause errors.
</span>        <span class="ActionScriptASDoc">/**
         * Creates an &lt;code&gt;IAsyncTestResponder&lt;/code&gt; that pend and either call the &lt;code&gt;eventHandler&lt;/code&gt; or the
         * &lt;code&gt;timeoutHandler&lt;/code&gt;, passing the &lt;code&gt;passThroughData&lt;/code&gt;, depending on whether the
         * &lt;code&gt;timeout&lt;/code&gt; period has been reached.
         * 
         * @param responder The responder that will be executed if the &lt;code&gt;IResponder&lt;/code&gt; is called before 
         * the &lt;code&gt;timeout&lt;/code&gt; has expired.
         * @param timeout The length of time, in milliseconds, before the &lt;code&gt;timeoutHandler&lt;/code&gt; will be executed.
         * @param passThroughData An Object that can be given information about the current test; this information will 
         * be available for both the &lt;code&gt;eventHandler&lt;/code&gt; and the &lt;code&gt;timeoutHandler&lt;/code&gt;.
         * @param timeoutHandler The Function that will be executed if the &lt;code&gt;timeout&lt;/code&gt; time is reached prior to
         * the expected event being dispatched.
         * 
         * @return an &lt;code&gt;IResponder&lt;/code&gt; that will determine whether the &lt;code&gt;timeout&lt;/code&gt; has been reached.
         */</span>
        <span class="ActionScriptDefault_Text">CONFIG</span><span class="ActionScriptOperator">::</span><span class="ActionScriptDefault_Text">useFlexClasses</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">asyncResponder</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">responder</span>:<span class="ActionScriptOperator">*</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">timeout</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">passThroughData</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">timeoutHandler</span>:<span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">IResponder</span> <span class="ActionScriptBracket/Brace">{</span> 

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">asyncResponder</span>:<span class="ActionScriptDefault_Text">IAsyncTestResponder</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">responder</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">IResponder</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">responder</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">ITestResponder</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptString">"Object provided to responder parameter of asyncResponder is not a IResponder or ITestResponder"</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptASDoc">/**If the user passes use an IAsyncTestResponder of their own, then we do not need to wrap it in our own AsyncTestResponder class
             * This allows the use of a different type of responder than our standard, however, it is the responsibility of the IAsyncTestResponder
             * we are passed to dispatch the requisite AsyncResponseEvent events in response to a result or fault.
             * 
             * In your own code, you can therefore do something like:
             * 
             * asyncResponder( IResponder, timeout );
             * 
             * OR
             * 
             * asyncResponder( mySpecialResponder implements IAsyncTestResponder, timeout );
             * 
             * */</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">responder</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">IAsyncTestResponder</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">asyncResponder</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">responder</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">asyncResponder</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AsyncTestResponder</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">responder</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">asyncHandler</span>:<span class="ActionScriptDefault_Text">AsyncHandler</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AsyncHandler</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">handleAsyncTestResponderEvent</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">timeout</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">passThroughData</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">timeoutHandler</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">AsyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">EVENT_FIRED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">handleAsyncEventFired</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">AsyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TIMER_EXPIRED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">handleAsyncTimeOut</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span> <span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">pendingAsyncCalls</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">asyncHandler</span> <span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">asyncResponder</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">AsyncResponseEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESPONDER_FIRED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleEvent</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span> <span class="ActionScriptBracket/Brace">)</span>; 

            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">asyncResponder</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Removes all asynchronous event listeners for each pending asynchronous call.
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeAllAsyncEventListeners</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">pendingAsyncCalls</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">removeAsyncEventListeners</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">pendingAsyncCalls</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">AsyncHandler</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">pendingAsyncCalls</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">handler</span>:<span class="ActionScriptOperator">*</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">asyncFailureConditions</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">removeAsyncErrorEventListeners</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">handler</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">AsyncHandler</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span> 
            
            <span class="ActionScriptDefault_Text">asyncFailureConditions</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">true</span> <span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Called when the asynchronous timeout has been reached for a given test.  This method attempts to
         * call a timeout handler that has been associated with the asychronous test.  If no handler has
         * been specified, an error will be generated and the &lt;code&gt;ExpectAsync&lt;/code&gt; statement finishes.
         * 
         * @param event The event associated with the asynchronous timeout.
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">handleAsyncTimeOut</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">Event</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">asyncHandler</span>:<span class="ActionScriptDefault_Text">AsyncHandler</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">AsyncHandler</span>; 
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">failure</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            
            <span class="ActionScriptDefault_Text">removeAsyncEventListeners</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">asyncHandler</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">//Run the timeout handler if one exists; otherwise, send an error
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">timeoutHandler</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">protect</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">timeoutHandler</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">passThroughData</span> <span class="ActionScriptBracket/Brace">)</span>; 
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">failure</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;                
                <span class="ActionScriptDefault_Text">sendComplete</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AssertionError</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptString">"Timeout Occurred before expected event"</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">//protect( Assert.fail, "Timeout Occurred before expected event" );
</span>            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptComment">//Remove all future pending items
</span>            <span class="ActionScriptDefault_Text">removeAllAsyncEventListeners</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;            
            <span class="ActionScriptASDoc">/**
            var methodResult:TestMethodResult = testMonitor.getTestMethodResult( registeredMethod );
            if ( methodResult &amp;&amp; ( !methodResult.traceInformation ) ) {
                methodResult.executed = true;
                methodResult.testDuration = getTimer()-tickCountOnStart;
                methodResult.traceInformation = "Test completed via Async TimeOut in " + methodResult.testDuration + "ms";
            }
            **/</span>
            <span class="ActionScriptComment">//Our timeout has failed, declare this specific test complete and move along
</span>            <span class="ActionScriptDefault_Text">sendComplete</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Handles the AsyncResponseEvent that is thrown by the asyncResponder.
         * It sends data to the original responder based on if it is a result or fault status.
         * 
         * If the original responder is of type ITestResponder, then the passThroughData is passed to it.
         * 
         * @param event
         * @param passThroughData
         * 
         */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">handleAsyncTestResponderEvent</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">AsyncResponseEvent</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">passThroughData</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">originalResponder</span>:<span class="ActionScriptOperator">*</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">originalResponder</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">isTestResponder</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">originalResponder</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">ITestResponder</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">isTestResponder</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">status</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">'result'</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">isTestResponder</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">originalResponder</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">result</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">passThroughData</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">originalResponder</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">result</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptBracket/Brace">)</span>;                    
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">isTestResponder</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">originalResponder</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">fault</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">passThroughData</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">originalResponder</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">fault</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptBracket/Brace">)</span>;                    
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">handleAsyncErrorFired</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">AsyncEvent</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">message</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"Failing due to Async Event "</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">originalEvent</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">message</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">originalEvent</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptDefault_Text">sendComplete</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AssertionError</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">message</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Called when the asynchronous event has been fired prior to the timeout being reached.  This method attempts to
         * call event handler that has been associated with the asychronous test.  If no handler has
         * been specified, an error will be generated and the &lt;code&gt;ExpectAsync&lt;/code&gt; statement finishes.
         * 
         * @param event The &lt;code&gt;AsyncEvent&lt;/code&gt; event that has been dispatched.
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">handleAsyncEventFired</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">AsyncEvent</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">//Receiving this event is a good things... IF it is the first one we are waiting for
</span>            <span class="ActionScriptComment">//If it is not the first one on the stack though, we still need to fail.
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">asyncHandler</span>:<span class="ActionScriptDefault_Text">AsyncHandler</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">AsyncHandler</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">firstPendingAsync</span>:<span class="ActionScriptDefault_Text">AsyncHandler</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">failure</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            
            <span class="ActionScriptDefault_Text">removeAsyncEventListeners</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">asyncHandler</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">//Determine if any async calls remain
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">hasPendingAsync</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//Get the first async call
</span>                <span class="ActionScriptDefault_Text">firstPendingAsync</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pendingAsyncCalls</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">shift</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">AsyncHandler</span>;
                
                <span class="ActionScriptComment">//Determine if this was the expected async handler
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">firstPendingAsync</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptDefault_Text">asyncHandler</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">eventHandler</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span>  <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">//this actually needs to be the event object from the previous event
</span>                        <span class="ActionScriptDefault_Text">protect</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">eventHandler</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">originalEvent</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">firstPendingAsync</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">passThroughData</span> <span class="ActionScriptBracket/Brace">)</span>;  
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">//The first one on the stack is not the one we received. 
</span>                    <span class="ActionScriptComment">//We received this one out of order, which is a failure condition
</span>                    <span class="ActionScriptDefault_Text">failure</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                    <span class="ActionScriptDefault_Text">sendComplete</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AssertionError</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptString">"Asynchronous Event Received out of Order"</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptComment">//protect( Assert.fail, "Asynchronous Event Received out of Order" ); 
</span>                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//We received an event, but we were not waiting for one, failure
</span>                <span class="ActionScriptComment">//protect( Assert.fail, "Unexpected Asynchronous Event Occurred" );
</span>                <span class="ActionScriptDefault_Text">failure</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>; 
                <span class="ActionScriptDefault_Text">sendComplete</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AssertionError</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptString">"Unexpected Asynchronous Event Occurred"</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;                
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">hasPendingAsync</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">methodBodyExecuting</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">failure</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//We have no more pending async, *AND* the method body of the function that originated this message
</span>                <span class="ActionScriptComment">//has also finished, then let the test runner know
</span>                <span class="ActionScriptASDoc">/**
                var methodResult:TestMethodResult = testMonitor.getTestMethodResult( registeredMethod );
                if ( methodResult &amp;&amp; ( !methodResult.traceInformation )  ) {
                    methodResult.executed = true;
                    methodResult.testDuration = getTimer()-tickCountOnStart;
                    methodResult.traceInformation = "Test completed via Async Event in " + methodResult.testDuration + "ms";
                }
                **/</span>
                <span class="ActionScriptDefault_Text">sendComplete</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;            
            <span class="ActionScriptBracket/Brace">}</span>
            
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Handles the next steps in a &lt;code&gt;SequenceRunner&lt;/code&gt;.
         * 
         * @param event The event boradcast by the last step in the sequence.
         * @param sequenceRunner The runner responsible for running the steps in the sequence.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">handleNextSequence</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">sequenceRunner</span>:<span class="ActionScriptDefault_Text">SequenceRunner</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//Remove the listener for this particular item
</span>                <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">currentTarget</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">handleNextSequence</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptDefault_Text">sequenceRunner</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">continueSequence</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">startAsyncTimers</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Creates an &lt;code&gt;IAsyncTestResponder&lt;/code&gt; that pend and either call the &lt;code&gt;eventHandler&lt;/code&gt; or the
         * &lt;code&gt;timeoutHandler&lt;/code&gt;, passing the &lt;code&gt;passThroughData&lt;/code&gt;, depending on whether the
         * &lt;code&gt;timeout&lt;/code&gt; period has been reached.
         * 
         * @param resultHandler The result &lt;code&gt;Function&lt;/code&gt; that will be executed if the &lt;code&gt;Responder&lt;/code&gt; is called on its result before 
         * the &lt;code&gt;timeout&lt;/code&gt; has expired.
         * @param faultHandler The fault &lt;code&gt;Function&lt;/code&gt; that will be executed if the &lt;code&gt;Responder&lt;/code&gt; is called on its fault before 
         * the &lt;code&gt;timeout&lt;/code&gt; has expired.
         * @param timeout The length of time, in milliseconds, before the &lt;code&gt;timeoutHandler&lt;/code&gt; will be executed.
         * @param passThroughData An Object that can be given information about the current test; this information will 
         * be available for both the &lt;code&gt;eventHandler&lt;/code&gt; and the &lt;code&gt;timeoutHandler&lt;/code&gt;.
         * @param timeoutHandler The Function that will be executed if the &lt;code&gt;timeout&lt;/code&gt; time is reached prior to
         * the expected event being dispatched.
         * 
         * @return an &lt;code&gt;IResponder&lt;/code&gt; that will determine whether the &lt;code&gt;timeout&lt;/code&gt; has been reached.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">asyncNativeResponder</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">resultHandler</span> : <span class="ActionScriptDefault_Text">Function</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">faultHandler</span> : <span class="ActionScriptDefault_Text">Function</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">timeout</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">passThroughData</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">timeoutHandler</span>:<span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Responder</span> <span class="ActionScriptBracket/Brace">{</span> 
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">asyncResponder</span>:<span class="ActionScriptDefault_Text">AsyncNativeTestResponder</span>;
            
            <span class="ActionScriptDefault_Text">asyncResponder</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AsyncNativeTestResponder</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">resultHandler</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">faultHandler</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">asyncHandler</span>:<span class="ActionScriptDefault_Text">AsyncHandler</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AsyncHandler</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">handleAsyncNativeTestResponderEvent</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">timeout</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">passThroughData</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">timeoutHandler</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">AsyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">EVENT_FIRED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">handleAsyncEventFired</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">AsyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TIMER_EXPIRED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">handleAsyncTimeOut</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">pendingAsyncCalls</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">asyncHandler</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">asyncResponder</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">AsyncResponseEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESPONDER_FIRED</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">asyncHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handleEvent</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span> <span class="ActionScriptBracket/Brace">)</span>; 
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">asyncResponder</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Handles the AsyncResponseEvent that is thrown by the asyncResponder.
         * It sends data to the original responder based on if it is a result or fault status.
         * 
         * @param event
         * @param passThroughData
         * 
         */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">handleAsyncNativeTestResponderEvent</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">AsyncResponseEvent</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">passThroughData</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">methodHandler</span>:<span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">methodHandler</span>;
            <span class="ActionScriptDefault_Text">methodHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">call</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * 
         * @param event
         * @param sequenceRunner
         * 
         */</span>
        <span class="ActionScriptComment">// We have a toggle in the compiler arguments so that we can choose whether or not the flex classes should
</span>        <span class="ActionScriptComment">// be compiled into the FlexUnit swc.  For actionscript only projects we do not want to compile the
</span>        <span class="ActionScriptComment">// flex classes since it will cause errors.
</span>        <span class="ActionScriptDefault_Text">CONFIG</span><span class="ActionScriptOperator">::</span><span class="ActionScriptDefault_Text">useFlexClasses</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">handleBindableNextSequence</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">sequenceRunner</span>:<span class="ActionScriptDefault_Text">SequenceRunner</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">sequenceRunner</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getPendingStep</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">SequenceBindingWaiter</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>

                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sequenceBinding</span>:<span class="ActionScriptDefault_Text">SequenceBindingWaiter</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sequenceRunner</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getPendingStep</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">SequenceBindingWaiter</span>;

                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">PropertyChangeEvent</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">propName</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">PropertyChangeEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">property</span>
        
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">propName</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">sequenceBinding</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">propertyName</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">Assert</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">fail</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptString">"Incorrect Property Change Event Received"</span> <span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span> 
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">//Remove the listener for this particular item
</span>                    <span class="ActionScriptDefault_Text">sequenceBinding</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">changeWatcher</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">unwatch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptComment">//event.currentTarget.removeEventListener(event.type, handleBindableNextSequence );
</span>    
                    <span class="ActionScriptDefault_Text">sequenceRunner</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">continueSequence</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span> <span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptDefault_Text">startAsyncTimers</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span> 
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">Assert</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">fail</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptString">"Event Received out of Order"</span> <span class="ActionScriptBracket/Brace">)</span>; 
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Starts the timers for each pending asynchronous call.
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">startAsyncTimers</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">pendingAsyncCalls</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">pendingAsyncCalls</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">AsyncHandler</span> <span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">startTimer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * If the test has not yet been marked as complete, mark the &lt;code&gt;ExpectAsync&lt;/code&gt; statement as having finished
         * and notify the parent token.
         * 
         * @param error The potential error to send to the parent token.
         */</span>
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">sendComplete</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">error</span>:<span class="ActionScriptDefault_Text">Error</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">//If the test has not completed, do not notify the parentToken that this statement has finished executing
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">testComplete</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">methodBodyExecuting</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptDefault_Text">testComplete</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">AsyncLocator</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cleanUpCallableForTest</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">objectUnderTest</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">removeAllAsyncEventListeners</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">parentToken</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sendResult</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">error</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Retrieves the object used for registering this &lt;code&gt;ExpectAsync&lt;/code&gt; which
         * implements &lt;code&gt;IAsyncHandlingStatement&lt;/code&gt; 
         * 
         * @param obj The object used to obtain the registration object.
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getObjectForRegistration</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">obj</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">registrationObj</span>:<span class="ActionScriptDefault_Text">Object</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">obj</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">TestClass</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">registrationObj</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">obj</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">TestClass</span> <span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">asClass</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">registrationObj</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">obj</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">registrationObj</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Registers the &lt;code&gt;ExpectAsync&lt;/code&gt; statment for the current object being tested and evaluates the object that 
         * implements the &lt;code&gt;IAsyncStatement&lt;/code&gt; that was provided to the &lt;code&gt;ExpectAsync&lt;/code&gt; class.
         * 
         * @param parentToken The token to be notified when the potential asynchronous call have finished.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">evaluate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">parentToken</span>:<span class="ActionScriptDefault_Text">AsyncTestToken</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
             <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentToken</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parentToken</span>;
            
            <span class="ActionScriptComment">//Register this statement with the current object that is being tested
</span>             <span class="ActionScriptDefault_Text">AsyncLocator</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">registerStatementForTest</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">getObjectForRegistration</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">objectUnderTest</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">methodBodyExecuting</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
             <span class="ActionScriptDefault_Text">statement</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">evaluate</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">myToken</span> <span class="ActionScriptBracket/Brace">)</span>;
             <span class="ActionScriptDefault_Text">methodBodyExecuting</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * A handler method that is called in order to wait once an asynchronous event has been dispatched.
         * 
         * @param event The event that was received.
         * @param passThroughData An Object that contains information to pass to the handler.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">pendUntilComplete</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">passThroughData</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * A handler method that is called in order to fail for a given asynchronous event once an it
         * has been dispatched.
         * 
         * @param event The event that was received.
         * @param passThroughData An Object that contains information to pass to the handler.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">failOnComplete</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">passThroughData</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">message</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"Unexpected event received "</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">message</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">event</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">sendComplete</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AssertionError</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">message</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Determines if there are any more pending asynchronous calls; if there are, keep running the calls if there are 
         * no errors.  If all calls have finished or an error was encountered in the &lt;code&gt;result&lt;/code&gt;, report the error
         * to the parent token and stop tracking the asynchronous events.
         * 
         * @param result The &lt;code&gt;ChildResult&lt;/code&gt; to check to see if there is an error.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">handleNextExecuteComplete</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">result</span>:<span class="ActionScriptDefault_Text">ChildResult</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">pendingAsyncCalls</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 0 <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//we are all done, no more pending asyncs, we can go on and live a good life for the few moments before we are gced                
</span>                <span class="ActionScriptDefault_Text">sendComplete</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">result</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">error</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">//parentToken.sendResult( result.error );
</span>            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">result</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">result</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">error</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">//If we already have an error, we need to report it now, not coninue
</span>                    <span class="ActionScriptDefault_Text">sendComplete</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">result</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">error</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">startAsyncTimers</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Determine if the &lt;code&gt;method&lt;/code&gt; is asynchronous for a test method that is of the expected 
         * metadata &lt;code&gt;type&lt;/code&gt;.
         * 
         * @param method The &lt;code&gt;FrameworkMethod&lt;/code&gt; that is potentially asynchronous.
         * @param type The expected metadata type of the test method (ex: "Test", "Before", "After").
         * 
         * @return a Boolean value indicating whether the provided &lt;code&gt;method&lt;/code&gt; is asynchronous.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">hasAsync</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">method</span>:<span class="ActionScriptDefault_Text">FrameworkMethod</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">type</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"Test"</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">async</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getSpecificMetaDataArgValue</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptString">"async"</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">asyncBool</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">async</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">"true"</span> <span class="ActionScriptBracket/Brace">)</span>; 
             
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">asyncBool</span>;            
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Constructor.
         * 
         * @param objectUnderTest The current object that is being tested.
         * @param statement The current &lt;code&gt;IAsyncStatement&lt;/code&gt; that will be decorated with the
         * the &lt;code&gt;ExpectAsync&lt;/code&gt; class.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">ExpectAsync</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">objectUnderTest</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">statement</span>:<span class="ActionScriptDefault_Text">IAsyncStatement</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">objectUnderTest</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">objectUnderTest</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">statement</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">statement</span>;
            
            <span class="ActionScriptComment">//Create a new token that will alert this class when the provided statement has completed
</span>            <span class="ActionScriptDefault_Text">myToken</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AsyncTestToken</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">ClassNameUtil</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getLoggerFriendlyClassName</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">this</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">myToken</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addNotificationMethod</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">handleNextExecuteComplete</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">pendingAsyncCalls</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">asyncFailureConditions</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptReserved">true</span> <span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
