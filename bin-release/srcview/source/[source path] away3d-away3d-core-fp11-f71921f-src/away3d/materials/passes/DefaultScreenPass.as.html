<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>DefaultScreenPass.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">materials</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">passes</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">arcane</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cameras</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Camera3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">base</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">IRenderable</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">managers</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Stage3DProxy</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lights</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">LightBase</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">materials</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MaterialBase</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">materials</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BasicAmbientMethod</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">materials</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BasicDiffuseMethod</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">materials</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BasicNormalMethod</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">materials</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BasicSpecularMethod</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">materials</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ColorTransformMethod</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">materials</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ShadingMethodBase</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">materials</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ShaderRegisterCache</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">materials</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;

    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BitmapData</span>;

    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Context3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Context3DProgramType</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Context3DVertexBufferFormat</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ColorTransform</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Matrix</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Vector3D</span>;

    <span class="ActionScriptReserved">use</span> <span class="ActionScriptReserved">namespace</span> <span class="ActionScriptDefault_Text">arcane</span>;

    <span class="ActionScriptASDoc">/**
     * DefaultScreenPass is a shader pass that uses shader methods to compile a complete program.
     *
     * @see away3d.materials.methods.ShadingMethodBase
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">DefaultScreenPass</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">MaterialPassBase</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_cameraPositionData</span> : <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_lightColorData</span> : <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_uvTransformData</span> : <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span>;

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_colorTransformMethod</span> : <span class="ActionScriptDefault_Text">ColorTransformMethod</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_normalMethod</span> : <span class="ActionScriptDefault_Text">BasicNormalMethod</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ambientMethod</span> : <span class="ActionScriptDefault_Text">BasicAmbientMethod</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_shadowMethod</span> : <span class="ActionScriptDefault_Text">ShadingMethodBase</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_diffuseMethod</span> : <span class="ActionScriptDefault_Text">BasicDiffuseMethod</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_specularMethod</span> : <span class="ActionScriptDefault_Text">BasicSpecularMethod</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_methods</span> : <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">ShadingMethodBase</span><span class="ActionScriptBracket/Brace">&gt;</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_registerCache</span> : <span class="ActionScriptDefault_Text">ShaderRegisterCache</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_vertexCode</span> : <span class="ActionScriptDefault_Text">String</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_fragmentCode</span> : <span class="ActionScriptDefault_Text">String</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_projectionDependencies</span> : <span class="ActionScriptDefault_Text">uint</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_normalDependencies</span> : <span class="ActionScriptDefault_Text">uint</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_viewDirDependencies</span> : <span class="ActionScriptDefault_Text">uint</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_uvDependencies</span> : <span class="ActionScriptDefault_Text">uint</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_secondaryUVDependencies</span> : <span class="ActionScriptDefault_Text">uint</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_globalPosDependencies</span> : <span class="ActionScriptDefault_Text">uint</span>;

        <span class="ActionScriptComment">// registers
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_uvBufferIndex</span> : <span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_secondaryUVBufferIndex</span> : <span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_normalBufferIndex</span> : <span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_tangentBufferIndex</span> : <span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_sceneMatrixIndex</span> : <span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_sceneNormalMatrixIndex</span> : <span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_lightsColorIndex</span> : <span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_cameraPositionIndex</span> : <span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_uvTransformIndex</span> : <span class="ActionScriptDefault_Text">int</span>;

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_projectionFragmentReg</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_normalFragmentReg</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_viewDirFragmentReg</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_lightDirFragmentRegs</span> : <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">ShaderRegisterElement</span><span class="ActionScriptBracket/Brace">&gt;</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_lightInputIndices</span> : <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">&gt;</span>;

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_normalVarying</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_tangentVarying</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_bitangentVarying</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_uvVaryingReg</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_secondaryUVVaryingReg</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_viewDirVaryingReg</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_shadedTargetReg</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_globalPositionReg</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_localPositionRegister</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_positionMatrixRegs</span> : <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">ShaderRegisterElement</span><span class="ActionScriptBracket/Brace">&gt;</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_normalInput</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_tangentInput</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_animatedNormalReg</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_animatedTangentReg</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_commonsReg</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_commonsRegIndex</span> : <span class="ActionScriptDefault_Text">int</span>;

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_commonsData</span> : <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>.5<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_passes</span> : <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">MaterialPassBase</span><span class="ActionScriptBracket/Brace">&gt;</span>;
        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_passesDirty</span> : <span class="ActionScriptDefault_Text">Boolean</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_animateUVs</span> : <span class="ActionScriptDefault_Text">Boolean</span>;



        <span class="ActionScriptASDoc">/**
         * Creates a new DefaultScreenPass objects.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">DefaultScreenPass</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">material</span> : <span class="ActionScriptDefault_Text">MaterialBase</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">super</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_material</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">material</span>;

            <span class="ActionScriptDefault_Text">_methods</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">ShadingMethodBase</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_normalMethod</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BasicNormalMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_ambientMethod</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BasicAmbientMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_diffuseMethod</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BasicDiffuseMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_specularMethod</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BasicSpecularMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_ambientMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">animateUVs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_animateUVs</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">animateUVs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> : <span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_animateUVs</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_animateUVs</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_animateUVs</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">invalidateShaderProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_uvTransformData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 1<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">null</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         */</span>
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">mipmap</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> : <span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_mipmap</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mipmap</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * The ColorTransform object to transform the colour of the material with.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">colorTransform</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">ColorTransform</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">colorTransform</span> : <span class="ActionScriptReserved">null</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">colorTransform</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> : <span class="ActionScriptDefault_Text">ColorTransform</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">colorTransformMethod</span> <span class="ActionScriptOperator">||=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ColorTransformMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">colorTransform</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
                <span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                <span class="ActionScriptDefault_Text">colorTransformMethod</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_colorTransformMethod</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         */</span>
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">deep</span> : <span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">deep</span><span class="ActionScriptBracket/Brace">)</span>;

<span class="ActionScriptComment">//            if (_normalMapTexture) _normalMapTexture.dispose(deep);
</span>            <span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">deep</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">deep</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">deep</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_ambientMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">deep</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">deep</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">deep</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span> : <span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">deep</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Adds a method to change the material after all lighting is performed.
         * @param method The method to be added.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">addMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">method</span> : <span class="ActionScriptDefault_Text">ShadingMethodBase</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">method</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>;
            <span class="ActionScriptDefault_Text">invalidateShaderProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">hasMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">method</span> : <span class="ActionScriptDefault_Text">ShadingMethodBase</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">method</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;=</span> 0;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Inserts a method to change the material after all lighting is performed at the given index.
         * @param method The method to be added.
         * @param index The index of the method's occurrence
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">addMethodAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">method</span> : <span class="ActionScriptDefault_Text">ShadingMethodBase</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">index</span> : <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">splice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">method</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>;
            <span class="ActionScriptDefault_Text">invalidateShaderProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getMethodAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> : <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">ShadingMethodBase</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">numMethods</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">int</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Removes a method from the pass.
         * @param method The method to be removed.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">method</span> : <span class="ActionScriptDefault_Text">ShadingMethodBase</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index</span> : <span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">method</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">splice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">invalidateShaderProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * The tangent space normal map to influence the direction of the surface for each texel.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">normalMap</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">BitmapData</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalMap</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">normalMap</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> : <span class="ActionScriptDefault_Text">BitmapData</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalMap</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
        <span class="ActionScriptBracket/Brace">}</span>


        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         */</span>
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">lights</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> : <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">LightBase</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lights</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
            <span class="ActionScriptDefault_Text">_lightColorData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_numLights</span><span class="ActionScriptOperator">*</span>8<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">invalidateShaderProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">normalMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">BasicNormalMethod</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_normalMethod</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">normalMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> : <span class="ActionScriptDefault_Text">BasicNormalMethod</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">copyFrom</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>;
            <span class="ActionScriptDefault_Text">_normalMethod</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
            <span class="ActionScriptDefault_Text">invalidateShaderProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">ambientMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">BasicAmbientMethod</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_ambientMethod</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">ambientMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> : <span class="ActionScriptDefault_Text">BasicAmbientMethod</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_ambientMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">copyFrom</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_ambientMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>;
            <span class="ActionScriptDefault_Text">_ambientMethod</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
            <span class="ActionScriptDefault_Text">invalidateShaderProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">shadowMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">ShadingMethodBase</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_shadowMethod</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">shadowMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> : <span class="ActionScriptDefault_Text">ShadingMethodBase</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>;
            <span class="ActionScriptDefault_Text">_shadowMethod</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
            <span class="ActionScriptDefault_Text">invalidateShaderProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * The method to perform diffuse shading.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">diffuseMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">BasicDiffuseMethod</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_diffuseMethod</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">diffuseMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> : <span class="ActionScriptDefault_Text">BasicDiffuseMethod</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">copyFrom</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_diffuseMethod</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
            <span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>;
            <span class="ActionScriptDefault_Text">invalidateShaderProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * The method to perform specular shading.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">specularMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">BasicSpecularMethod</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_specularMethod</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">specularMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> : <span class="ActionScriptDefault_Text">BasicSpecularMethod</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">copyFrom</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>;

            <span class="ActionScriptDefault_Text">_specularMethod</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;

            <span class="ActionScriptDefault_Text">invalidateShaderProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * A method for reserved actions such as ColorTransformations.
         * @private
         */</span>
        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">colorTransformMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">ColorTransformMethod</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_colorTransformMethod</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">colorTransformMethod</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> : <span class="ActionScriptDefault_Text">ColorTransformMethod</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_colorTransformMethod</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_colorTransformMethod</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">invalidateShaderProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_colorTransformMethod</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parentPass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         */</span>
        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getVertexCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_vertexCode</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         */</span>
        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getFragmentCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_fragmentCode</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         */</span>
        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">activate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span> : <span class="ActionScriptDefault_Text">Stage3DProxy</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">camera</span> : <span class="ActionScriptDefault_Text">Camera3D</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">context</span> : <span class="ActionScriptDefault_Text">Context3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_context3D</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">len</span> : <span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;

            <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">activate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_commonsRegIndex</span> <span class="ActionScriptOperator">&gt;=</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setProgramConstantsFromVector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Context3DProgramType</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FRAGMENT</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_commonsRegIndex</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_commonsData</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalDependencies</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hasOutput</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">activate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_ambientMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">activate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">activate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">activate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">activate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">activate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span> : <span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">len</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">activate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_cameraPositionIndex</span> <span class="ActionScriptOperator">&gt;=</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pos</span> : <span class="ActionScriptDefault_Text">Vector3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">scenePosition</span>;
                <span class="ActionScriptDefault_Text">_cameraPositionData</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptDefault_Text">_cameraPositionData</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptDefault_Text">_cameraPositionData</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span>;
                <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setProgramConstantsFromVector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Context3DProgramType</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">VERTEX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_cameraPositionIndex</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_cameraPositionData</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         */</span>
        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">deactivate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span> : <span class="ActionScriptDefault_Text">Stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">deactivate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">len</span> : <span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalDependencies</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hasOutput</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">deactivate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_ambientMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">deactivate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">deactivate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">deactivate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">deactivate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">deactivate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span> : <span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">len</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">deactivate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span>;

<span class="ActionScriptComment">//            if (_normalMapIndex &gt;= 0) stage3DProxy.setTextureAt(_normalMapIndex, null);
</span>        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         */</span>
        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">render</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">renderable</span> : <span class="ActionScriptDefault_Text">IRenderable</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">stage3DProxy</span> : <span class="ActionScriptDefault_Text">Stage3DProxy</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">camera</span> : <span class="ActionScriptDefault_Text">Camera3D</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">context</span> : <span class="ActionScriptDefault_Text">Context3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_context3D</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_uvBufferIndex</span> <span class="ActionScriptOperator">&gt;=</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setSimpleVertexBuffer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_uvBufferIndex</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">renderable</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getUVBuffer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">Context3DVertexBufferFormat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FLOAT_2</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_secondaryUVBufferIndex</span> <span class="ActionScriptOperator">&gt;=</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setSimpleVertexBuffer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_secondaryUVBufferIndex</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">renderable</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getSecondaryUVBuffer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">Context3DVertexBufferFormat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FLOAT_2</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalBufferIndex</span> <span class="ActionScriptOperator">&gt;=</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setSimpleVertexBuffer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalBufferIndex</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">renderable</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getVertexNormalBuffer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">Context3DVertexBufferFormat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FLOAT_3</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_tangentBufferIndex</span> <span class="ActionScriptOperator">&gt;=</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setSimpleVertexBuffer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_tangentBufferIndex</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">renderable</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getVertexTangentBuffer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">Context3DVertexBufferFormat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FLOAT_3</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_sceneMatrixIndex</span> <span class="ActionScriptOperator">&gt;=</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setProgramConstantsFromMatrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Context3DProgramType</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">VERTEX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_sceneMatrixIndex</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">renderable</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sceneTransform</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_sceneNormalMatrixIndex</span> <span class="ActionScriptOperator">&gt;=</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setProgramConstantsFromMatrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Context3DProgramType</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">VERTEX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_sceneNormalMatrixIndex</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">renderable</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">inverseSceneTransform</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uvTransform</span> : <span class="ActionScriptDefault_Text">Matrix</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_animateUVs</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">uvTransform</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">renderable</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">uvTransform</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uvTransform</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_uvTransformData</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uvTransform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">a</span>; <span class="ActionScriptDefault_Text">_uvTransformData</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uvTransform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b</span>; <span class="ActionScriptDefault_Text">_uvTransformData</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uvTransform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tx</span>;
                    <span class="ActionScriptDefault_Text">_uvTransformData</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uvTransform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span>; <span class="ActionScriptDefault_Text">_uvTransformData</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uvTransform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">d</span>; <span class="ActionScriptDefault_Text">_uvTransformData</span><span class="ActionScriptBracket/Brace">[</span>7<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uvTransform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ty</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScripttrace">trace</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"Warning: animateUVs is set to true with an IRenderable without a uvTransform. Identity matrix assumed."</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_uvTransformData</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 1; <span class="ActionScriptDefault_Text">_uvTransformData</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">_uvTransformData</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 0;
                    <span class="ActionScriptDefault_Text">_uvTransformData</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">_uvTransformData</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 1; <span class="ActionScriptDefault_Text">_uvTransformData</span><span class="ActionScriptBracket/Brace">[</span>7<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setProgramConstantsFromVector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Context3DProgramType</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">VERTEX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_uvTransformIndex</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_uvTransformData</span><span class="ActionScriptOperator">,</span> 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_numLights</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">len</span> : <span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lights</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;

                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">len</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">_numLights</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">len</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_numLights</span>;

                <span class="ActionScriptDefault_Text">updateLights</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">context</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setProgramConstantsFromVector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Context3DProgramType</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FRAGMENT</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_lightsColorIndex</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_lightColorData</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_numLights</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalDependencies</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hasOutput</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setRenderState</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">renderable</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lights</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_ambientMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setRenderState</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">renderable</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lights</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setRenderState</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">renderable</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lights</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setRenderState</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">renderable</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lights</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setRenderState</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">renderable</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lights</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setRenderState</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">renderable</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lights</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">len</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span> : <span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">len</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setRenderState</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">renderable</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lights</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">render</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">renderable</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>


        <span class="ActionScriptASDoc">/**
         * Marks the shader program as invalid, so it will be recompiled before the next render.
         */</span>
        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">invalidateShaderProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">invalidateShaderProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_passesDirty</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;

            <span class="ActionScriptDefault_Text">_passes</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">MaterialPassBase</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hasOutput</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">addPasses</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">passes</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">addPasses</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_ambientMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">passes</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">addPasses</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">passes</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">addPasses</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">passes</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">addPasses</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">passes</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">addPasses</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">passes</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span> : <span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">addPasses</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">passes</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">_material</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">invalidateDepthShaderProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         */</span>
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">updateProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span> : <span class="ActionScriptDefault_Text">Stage3DProxy</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">polyOffsetReg</span> : <span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">reset</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">updateProgram</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage3DProxy</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">polyOffsetReg</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Resets the compilation state.
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">reset</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_registerCache</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ShaderRegisterCache</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">vertexConstantOffset</span> <span class="ActionScriptOperator">=</span> 4;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">vertexAttributesOffset</span> <span class="ActionScriptOperator">=</span> 1;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">reset</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_lightDirFragmentRegs</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">ShaderRegisterElement</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_numLights</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_lightInputIndices</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_numLights</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">setMethodProps</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">setMethodProps</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">setMethodProps</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">setMethodProps</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_ambientMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">setMethodProps</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">setMethodProps</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span> : <span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">setMethodProps</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_commonsReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_numUsedVertexConstants</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">_numUsedStreams</span> <span class="ActionScriptOperator">=</span> 1;

            <span class="ActionScriptDefault_Text">_animatableAttributes</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"va0"</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">_targetRegisters</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"vt0"</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">_vertexCode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">""</span>;
            <span class="ActionScriptDefault_Text">_fragmentCode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">""</span>;
            <span class="ActionScriptDefault_Text">_projectedTargetRegister</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;

            <span class="ActionScriptDefault_Text">_localPositionRegister</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexVectorTemp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addVertexTempUsages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_localPositionRegister</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">compile</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_numUsedVertexConstants</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">numUsedVertexConstants</span>;
            <span class="ActionScriptDefault_Text">_numUsedStreams</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">numUsedStreams</span>;
            <span class="ActionScriptDefault_Text">_numUsedTextures</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">numUsedTextures</span>;

            <span class="ActionScriptDefault_Text">cleanUp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">cleanUp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_projectionFragmentReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_viewDirFragmentReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_lightDirFragmentRegs</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;

            <span class="ActionScriptDefault_Text">_normalVarying</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_tangentVarying</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_bitangentVarying</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_uvVaryingReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_secondaryUVVaryingReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_viewDirVaryingReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;

            <span class="ActionScriptDefault_Text">_shadedTargetReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_globalPositionReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_localPositionRegister</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_positionMatrixRegs</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_normalInput</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_tangentInput</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_animatedNormalReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_animatedTangentReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_commonsReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;

            <span class="ActionScriptDefault_Text">_registerCache</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cleanCompilationData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cleanCompilationData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_ambientMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_ambientMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cleanCompilationData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cleanCompilationData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cleanCompilationData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cleanCompilationData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">len</span> : <span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span> : <span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">len</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cleanCompilationData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_lights</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">len</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_lights</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">len</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_lights</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cleanCompilationData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setMethodProps</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">method</span> : <span class="ActionScriptDefault_Text">ShadingMethodBase</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">smooth</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_smooth</span>;
            <span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">repeat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_repeat</span>;
            <span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mipmap</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_mipmap</span>;
            <span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">numLights</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_numLights</span>;
            <span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">reset</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Compiles the actual shader code.
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">compile</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">calcDependencies</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_projectionDependencies</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">compileProjCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_uvDependencies</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">compileUVCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_secondaryUVDependencies</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">compileSecondaryUVCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_globalPosDependencies</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">compileGlobalPositionCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalDependencies</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// needs to be created before view
</span>                <span class="ActionScriptDefault_Text">_animatedNormalReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexVectorTemp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addVertexTempUsages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_animatedNormalReg</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_viewDirDependencies</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">compileViewDirCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">setMethodRegs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalDependencies</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">compileNormalCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;


            <span class="ActionScriptDefault_Text">setMethodRegs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">setMethodRegs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">setMethodRegs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_ambientMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">setMethodRegs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">setMethodRegs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span> : <span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">setMethodRegs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_numLights</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">compileLightDirCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_shadedTargetReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeFragmentVectorTemp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addFragmentTempUsages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_shadedTargetReg</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">compileLightingCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">compileMethods</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_fragmentCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">"mov "</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">fragmentOutputRegister</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span><span class="ActionScriptString">", "</span><span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_shadedTargetReg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"\n"</span>;

            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFragmentTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_shadedTargetReg</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">compileProjCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_projectionFragmentReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVarying</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_projectedTargetRegister</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexVectorTemp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_vertexCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_projectionFragmentReg</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">", "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_projectedTargetRegister</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"\n"</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setMethodRegs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">method</span> : <span class="ActionScriptDefault_Text">ShadingMethodBase</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">globalPosVertexReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_globalPositionReg</span>;
            <span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalFragmentReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_normalFragmentReg</span>;
            <span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">projectionReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_projectionFragmentReg</span>;
            <span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">UVFragmentReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_uvVaryingReg</span>;
            <span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">secondaryUVFragmentReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_secondaryUVVaryingReg</span>;
            <span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">viewDirFragmentReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewDirFragmentReg</span>;
            <span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">viewDirVaryingReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewDirVaryingReg</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Adds passes to the list.
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">addPasses</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">passes</span> : <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">MaterialPassBase</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">passes</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">len</span> : <span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">passes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;

            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span> : <span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">len</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">passes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">material</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">material</span>;
                <span class="ActionScriptDefault_Text">_passes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">passes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Calculates register dependencies for commonly used data.
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">calcDependencies</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">len</span> : <span class="ActionScriptDefault_Text">uint</span>;

            <span class="ActionScriptDefault_Text">_normalDependencies</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">_viewDirDependencies</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">_uvDependencies</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">_secondaryUVDependencies</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">_globalPosDependencies</span> <span class="ActionScriptOperator">=</span> 0;

            <span class="ActionScriptDefault_Text">_uvTransformIndex</span> <span class="ActionScriptOperator">=</span> -1;
            <span class="ActionScriptDefault_Text">_cameraPositionIndex</span> <span class="ActionScriptOperator">=</span> -1;
            <span class="ActionScriptDefault_Text">_commonsRegIndex</span> <span class="ActionScriptOperator">=</span> -1;
            <span class="ActionScriptDefault_Text">_uvBufferIndex</span> <span class="ActionScriptOperator">=</span> -1;
            <span class="ActionScriptDefault_Text">_secondaryUVBufferIndex</span> <span class="ActionScriptOperator">=</span> -1;
            <span class="ActionScriptDefault_Text">_normalBufferIndex</span> <span class="ActionScriptOperator">=</span> -1;
            <span class="ActionScriptDefault_Text">_tangentBufferIndex</span> <span class="ActionScriptOperator">=</span> -1;
            <span class="ActionScriptDefault_Text">_lightsColorIndex</span> <span class="ActionScriptOperator">=</span> -1;
            <span class="ActionScriptDefault_Text">_sceneMatrixIndex</span> <span class="ActionScriptOperator">=</span> -1;
            <span class="ActionScriptDefault_Text">_sceneNormalMatrixIndex</span> <span class="ActionScriptOperator">=</span> -1;

            <span class="ActionScriptDefault_Text">countMethodDependencies</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">countMethodDependencies</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">countMethodDependencies</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_ambientMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">countMethodDependencies</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">countMethodDependencies</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">len</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span> : <span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">len</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">countMethodDependencies</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalDependencies</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hasOutput</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">countMethodDependencies</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_viewDirDependencies</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">_globalPosDependencies</span>;

            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">_numLights</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_lights</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">positionBased</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">_globalPosDependencies</span>;
            <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptComment">//            if (_generateTangents &amp;&amp; normalMap) ++_uvDependencies;
</span>        <span class="ActionScriptBracket/Brace">}</span>


        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">countMethodDependencies</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">method</span> : <span class="ActionScriptDefault_Text">ShadingMethodBase</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">needsProjection</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">_projectionDependencies</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">needsGlobalPos</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">_globalPosDependencies</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">needsNormals</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">_normalDependencies</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">needsView</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">_viewDirDependencies</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">needsUV</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">_uvDependencies</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">needsSecondaryUV</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">_secondaryUVDependencies</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">compileGlobalPositionCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_globalPositionReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexVectorTemp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addVertexTempUsages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_globalPositionReg</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_globalPosDependencies</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_positionMatrixRegs</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">ShaderRegisterElement</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_positionMatrixRegs</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexConstant</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_positionMatrixRegs</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexConstant</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_positionMatrixRegs</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexConstant</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexConstant</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_sceneMatrixIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_positionMatrixRegs</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">index</span>;

            <span class="ActionScriptDefault_Text">_vertexCode</span> <span class="ActionScriptOperator">+=</span>     <span class="ActionScriptString">"m34 "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_globalPositionReg</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_localPositionRegister</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span><span class="ActionScriptString">", "</span><span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_positionMatrixRegs</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"\n"</span> <span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptString">"mov "</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">_globalPositionReg</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">".w, "</span><span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_localPositionRegister</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">".w     \n"</span>;
<span class="ActionScriptComment">//            _registerCache.removeVertexTempUsage(_localPositionRegister);
</span>        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">compileUVCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uvAttributeReg</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexAttribute</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_uvVaryingReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVarying</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_uvBufferIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uvAttributeReg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">index</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_animateUVs</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// a, b, 0, tx
</span>                <span class="ActionScriptComment">// c, d, 0, ty
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uvTransform1</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexConstant</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uvTransform2</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexConstant</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_uvTransformIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uvTransform1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">index</span>;

                <span class="ActionScriptDefault_Text">_vertexCode</span> <span class="ActionScriptOperator">+=</span>     <span class="ActionScriptString">"dp4 "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_uvVaryingReg</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">".x, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">uvAttributeReg</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">", "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">uvTransform1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"\n"</span> <span class="ActionScriptOperator">+</span>
                                <span class="ActionScriptString">"dp4 "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_uvVaryingReg</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">".y, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">uvAttributeReg</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">", "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">uvTransform2</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"\n"</span> <span class="ActionScriptOperator">+</span>
                                <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_uvVaryingReg</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">".zw, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">uvAttributeReg</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">".zw \n"</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_vertexCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_uvVaryingReg</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">", "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">uvAttributeReg</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"\n"</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">compileSecondaryUVCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uvAttributeReg</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexAttribute</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_secondaryUVVaryingReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVarying</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_secondaryUVBufferIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uvAttributeReg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">index</span>;

            <span class="ActionScriptDefault_Text">_vertexCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_secondaryUVVaryingReg</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">", "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">uvAttributeReg</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"\n"</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">compileNormalCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">normalMatrix</span> : <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">ShaderRegisterElement</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">ShaderRegisterElement</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span>3<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_normalFragmentReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeFragmentVectorTemp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addFragmentTempUsages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalFragmentReg</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_normalDependencies</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_normalInput</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexAttribute</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_normalBufferIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_normalInput</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">index</span>;

            <span class="ActionScriptDefault_Text">_normalVarying</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVarying</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_animatableAttributes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalInput</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_targetRegisters</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_animatedNormalReg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">normalMatrix</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexConstant</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">normalMatrix</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexConstant</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">normalMatrix</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexConstant</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexConstant</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_sceneNormalMatrixIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">normalMatrix</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">index</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">hasOutput</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// tangent stream required
</span>                <span class="ActionScriptDefault_Text">compileTangentVertexCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">normalMatrix</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">compileTangentNormalMapFragmentCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_vertexCode</span> <span class="ActionScriptOperator">+=</span>     <span class="ActionScriptString">"m33 "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_normalVarying</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_animatedNormalReg</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">normalMatrix</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"\n"</span> <span class="ActionScriptOperator">+</span>
                                <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_normalVarying</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">".w, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_animatedNormalReg</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">".w    \n"</span>;

                <span class="ActionScriptDefault_Text">_fragmentCode</span> <span class="ActionScriptOperator">+=</span>    <span class="ActionScriptString">"nrm "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_normalFragmentReg</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_normalVarying</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">".xyz    \n"</span> <span class="ActionScriptOperator">+</span>
                                    <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_normalFragmentReg</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">".w, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_normalVarying</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">".w        \n"</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeVertexTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_animatedNormalReg</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">compileTangentVertexCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">matrix</span> : <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">ShaderRegisterElement</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">normalTemp</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tanTemp</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bitanTemp1</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bitanTemp2</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;

            <span class="ActionScriptDefault_Text">_tangentVarying</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVarying</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_bitangentVarying</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVarying</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_tangentInput</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexAttribute</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_tangentBufferIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_tangentInput</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">index</span>;

            <span class="ActionScriptDefault_Text">_animatedTangentReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexVectorTemp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addVertexTempUsages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_animatedTangentReg</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_animatableAttributes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_tangentInput</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_targetRegisters</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_animatedTangentReg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">normalTemp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexVectorTemp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addVertexTempUsages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">normalTemp</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_vertexCode</span> <span class="ActionScriptOperator">+=</span>     <span class="ActionScriptString">"m33 "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">normalTemp</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_animatedNormalReg</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">matrix</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"\n"</span> <span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptString">"nrm "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">normalTemp</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">normalTemp</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz    \n"</span>;

            <span class="ActionScriptDefault_Text">tanTemp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexVectorTemp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addVertexTempUsages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tanTemp</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_vertexCode</span> <span class="ActionScriptOperator">+=</span>     <span class="ActionScriptString">"m33 "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tanTemp</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_animatedTangentReg</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">matrix</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"\n"</span> <span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptString">"nrm "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tanTemp</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tanTemp</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz    \n"</span>;

            <span class="ActionScriptDefault_Text">bitanTemp1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexVectorTemp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addVertexTempUsages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bitanTemp1</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">bitanTemp2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexVectorTemp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_vertexCode</span> <span class="ActionScriptOperator">+=</span>     <span class="ActionScriptString">"mul "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bitanTemp1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">normalTemp</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".yzx, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tanTemp</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".zxy    \n"</span> <span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptString">"mul "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bitanTemp2</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">normalTemp</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".zxy, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tanTemp</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".yzx    \n"</span> <span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptString">"sub "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bitanTemp2</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bitanTemp1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bitanTemp2</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz    \n"</span> <span class="ActionScriptOperator">+</span>

                            <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_tangentVarying</span>   <span class="ActionScriptOperator">+</span><span class="ActionScriptString">".x, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tanTemp</span>        <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".x    \n"</span> <span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_tangentVarying</span>   <span class="ActionScriptOperator">+</span><span class="ActionScriptString">".y, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bitanTemp2</span>        <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".x    \n"</span> <span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_tangentVarying</span>   <span class="ActionScriptOperator">+</span><span class="ActionScriptString">".z, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">normalTemp</span>      <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".x    \n"</span> <span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_tangentVarying</span>   <span class="ActionScriptOperator">+</span><span class="ActionScriptString">".w, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_normalInput</span>    <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".w    \n"</span> <span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_bitangentVarying</span> <span class="ActionScriptOperator">+</span><span class="ActionScriptString">".x, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tanTemp</span>        <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".y    \n"</span> <span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_bitangentVarying</span> <span class="ActionScriptOperator">+</span><span class="ActionScriptString">".y, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bitanTemp2</span>        <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".y    \n"</span> <span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_bitangentVarying</span> <span class="ActionScriptOperator">+</span><span class="ActionScriptString">".z, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">normalTemp</span>        <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".y    \n"</span> <span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_bitangentVarying</span> <span class="ActionScriptOperator">+</span><span class="ActionScriptString">".w, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_normalInput</span>    <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".w    \n"</span> <span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_normalVarying</span>    <span class="ActionScriptOperator">+</span><span class="ActionScriptString">".x, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tanTemp</span>         <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".z    \n"</span> <span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_normalVarying</span>    <span class="ActionScriptOperator">+</span><span class="ActionScriptString">".y, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bitanTemp2</span>        <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".z    \n"</span> <span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_normalVarying</span>    <span class="ActionScriptOperator">+</span><span class="ActionScriptString">".z, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">normalTemp</span>        <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".z    \n"</span> <span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_normalVarying</span>    <span class="ActionScriptOperator">+</span><span class="ActionScriptString">".w, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_normalInput</span>    <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".w    \n"</span>;

            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeVertexTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">normalTemp</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeVertexTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tanTemp</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeVertexTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bitanTemp1</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeVertexTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_animatedTangentReg</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">compileTangentNormalMapFragmentCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">t</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">b</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;

            <span class="ActionScriptDefault_Text">createCommons</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeFragmentVectorTemp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addFragmentTempUsages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">t</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeFragmentVectorTemp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addFragmentTempUsages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeFragmentVectorTemp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addFragmentTempUsages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_fragmentCode</span> <span class="ActionScriptOperator">+=</span>     <span class="ActionScriptString">"nrm "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_tangentVarying</span>   <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz    \n"</span> <span class="ActionScriptOperator">+</span>
                                <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".w, "</span>   <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_tangentVarying</span>   <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".w        \n"</span> <span class="ActionScriptOperator">+</span>
                                <span class="ActionScriptString">"nrm "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_tangentVarying</span>   <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz    \n"</span> <span class="ActionScriptOperator">+</span>
                                <span class="ActionScriptString">"nrm "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_bitangentVarying</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz    \n"</span> <span class="ActionScriptOperator">+</span>
                                <span class="ActionScriptString">"nrm "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_normalVarying</span>    <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz    \n"</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">temp</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeFragmentVectorTemp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addFragmentTempUsages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">temp</span><span class="ActionScriptOperator">,</span>  1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_fragmentCode</span> <span class="ActionScriptOperator">+=</span>     <span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFragmentPostLightingCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">temp</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span>
                                <span class="ActionScriptString">"sub "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">temp</span>                <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">temp</span>             <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_commonsReg</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">".xxx    \n"</span> <span class="ActionScriptOperator">+</span>
                                <span class="ActionScriptString">"nrm "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">temp</span>                 <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">temp</span>             <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz                            \n"</span> <span class="ActionScriptOperator">+</span>
                                <span class="ActionScriptString">"m33 "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_normalFragmentReg</span>    <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">temp</span>             <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">t</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"    \n"</span> <span class="ActionScriptOperator">+</span>
                                <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_normalFragmentReg</span>    <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".w,   "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_normalVarying</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".w                            \n"</span>;

            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFragmentTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">temp</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">needsView</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFragmentTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_viewDirFragmentReg</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">needsGlobalPos</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeVertexTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_globalPositionReg</span><span class="ActionScriptBracket/Brace">)</span>;
<span class="ActionScriptComment">//            _fragmentCode += AGAL.mov("oc", _normalFragmentReg+"");
</span>
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFragmentTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFragmentTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">t</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFragmentTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createCommons</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_commonsReg</span> <span class="ActionScriptOperator">||=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeFragmentConstant</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_commonsRegIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_commonsReg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">index</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">compileLightDirCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">light</span> : <span class="ActionScriptDefault_Text">LightBase</span>;

            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span> : <span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">_numLights</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">light</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_lights</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;

                <span class="ActionScriptDefault_Text">_vertexCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">light</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getVertexCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_globalPositionReg</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_fragmentCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">light</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFragmentCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptDefault_Text">_lightDirFragmentRegs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">light</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">fragmentDirectionRegister</span>;
                <span class="ActionScriptDefault_Text">_lightInputIndices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">light</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">shaderConstantIndex</span>;

                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">light</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">positionBased</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeVertexTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_globalPositionReg</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">compileViewDirCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cameraPositionReg</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVertexConstant</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_viewDirVaryingReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeVarying</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_viewDirFragmentReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeFragmentVectorTemp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addFragmentTempUsages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_viewDirFragmentReg</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_viewDirDependencies</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_cameraPositionIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cameraPositionReg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">index</span>;

            <span class="ActionScriptDefault_Text">_vertexCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">"sub "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_viewDirVaryingReg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span><span class="ActionScriptString">", "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cameraPositionReg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">", "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_globalPositionReg</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"\n"</span>;
            <span class="ActionScriptDefault_Text">_fragmentCode</span> <span class="ActionScriptOperator">+=</span>     <span class="ActionScriptString">"nrm "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_viewDirFragmentReg</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_viewDirVaryingReg</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz        \n"</span> <span class="ActionScriptOperator">+</span>
                                <span class="ActionScriptString">"mov "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_viewDirFragmentReg</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">".w,   "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_viewDirVaryingReg</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".w         \n"</span>;

            <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeVertexTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_globalPositionReg</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">compileLightingCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">diffuseColorReg</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">specularColorReg</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">shadowReg</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lightDirReg</span> : <span class="ActionScriptDefault_Text">ShaderRegisterElement</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">light</span> : <span class="ActionScriptDefault_Text">LightBase</span>;

            <span class="ActionScriptDefault_Text">_vertexCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getVertexCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_fragmentCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFragmentAGALPreLightingCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_vertexCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getVertexCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_fragmentCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFragmentAGALPreLightingCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span> : <span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">_numLights</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">light</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_lights</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">diffuseColorReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeFragmentConstant</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">specularColorReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeFragmentConstant</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">light</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">positionBased</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">lightDirReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeFragmentVectorTemp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addFragmentTempUsages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lightDirReg</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_fragmentCode</span> <span class="ActionScriptOperator">+=</span>     <span class="ActionScriptString">"nrm "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">lightDirReg</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz, "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_lightDirFragmentRegs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".xyz    \n"</span> <span class="ActionScriptOperator">+</span>
                                        <span class="ActionScriptDefault_Text">light</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getAttenuationCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lightDirReg</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptDefault_Text">lightDirReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_lightDirFragmentRegs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;

                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_lightsColorIndex</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_lightsColorIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">diffuseColorReg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">index</span>;
                <span class="ActionScriptDefault_Text">_fragmentCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFragmentCodePerLight</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lightDirReg</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">diffuseColorReg</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_fragmentCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">specularMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFragmentCodePerLight</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">lightDirReg</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">specularColorReg</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">light</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">positionBased</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFragmentTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lightDirReg</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptComment">//            _registerCache.removeFragmentTempUsage(lightDirReg);
</span>
            <span class="ActionScriptDefault_Text">_vertexCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_ambientMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getVertexCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_fragmentCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_ambientMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFragmentPostLightingCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_shadedTargetReg</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_ambientMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">needsNormals</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFragmentTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalFragmentReg</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_ambientMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">needsView</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFragmentTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_viewDirFragmentReg</span><span class="ActionScriptBracket/Brace">)</span>;


            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_vertexCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getVertexCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptBracket/Brace">)</span>;
<span class="ActionScriptComment">//                shadowReg = _registerCache.getFreeFragmentSingleTemp();
</span>                <span class="ActionScriptComment">// using normal to contain shadow data if available is perhaps risky :s
</span>                <span class="ActionScriptComment">// todo: improve compilation with lifetime analysis so this isn't necessary?
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalDependencies</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">shadowReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFreeFragmentVectorTemp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addFragmentTempUsages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">shadowReg</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptDefault_Text">shadowReg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_normalFragmentReg</span>;

                <span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">shadowRegister</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">shadowReg</span>;
                <span class="ActionScriptDefault_Text">_fragmentCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_shadowMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFragmentPostLightingCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">shadowReg</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">_fragmentCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFragmentPostLightingCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_shadedTargetReg</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">needsNormals</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFragmentTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalFragmentReg</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_diffuseMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">needsView</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFragmentTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_viewDirFragmentReg</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">shadowRegister</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">shadowReg</span>;
                <span class="ActionScriptDefault_Text">_fragmentCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFragmentPostLightingCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_shadedTargetReg</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">needsNormals</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFragmentTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalFragmentReg</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_specularMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">needsView</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFragmentTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_viewDirFragmentReg</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptComment">//            if (shadowReg &amp;&amp; _normalDependencies &gt; 0) _registerCache.removeFragmentTempUsage(shadowReg);
</span>        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">compileMethods</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">numMethods</span> : <span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;

            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span> : <span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">numMethods</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_vertexCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getVertexCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">needsGlobalPos</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeVertexTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_globalPositionReg</span><span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptDefault_Text">_fragmentCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFragmentPostLightingCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_shadedTargetReg</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">needsNormals</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFragmentTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_normalFragmentReg</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_methods</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">needsView</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFragmentTempUsage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_viewDirFragmentReg</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_vertexCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getVertexCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_fragmentCode</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_colorTransformMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFragmentPostLightingCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_registerCache</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_shadedTargetReg</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Updates the lights data for the render state.
         * @param lights The lights selected to shade the current object.
         * @param numLights The amount of lights available.
         * @param maxLights The maximum amount of lights supported.
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">updateLights</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">context</span> : <span class="ActionScriptDefault_Text">Context3D</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">light</span> : <span class="ActionScriptDefault_Text">LightBase</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span> : <span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">k</span> : <span class="ActionScriptDefault_Text">uint</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">spec</span> : <span class="ActionScriptDefault_Text">BasicSpecularMethod</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">specularMethod</span>;

            <span class="ActionScriptComment">// update vertex data
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">_numLights</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">light</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_lights</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">light</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setRenderState</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">context</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_lightInputIndices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptDefault_Text">_lightColorData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">light</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_diffuseR</span>;
                <span class="ActionScriptDefault_Text">_lightColorData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">light</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_diffuseG</span>;
                <span class="ActionScriptDefault_Text">_lightColorData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">light</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_diffuseB</span>;
                <span class="ActionScriptDefault_Text">_lightColorData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 1;

                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">spec</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_lightColorData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">light</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_specularR</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">spec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_specularR</span>;
                    <span class="ActionScriptDefault_Text">_lightColorData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">light</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_specularG</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">spec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_specularG</span>;
                    <span class="ActionScriptDefault_Text">_lightColorData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">light</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_specularB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">spec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_specularB</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_lightColorData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 0;
                    <span class="ActionScriptDefault_Text">_lightColorData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 0;
                    <span class="ActionScriptDefault_Text">_lightColorData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptBracket/Brace">}</span>

                <span class="ActionScriptDefault_Text">_lightColorData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 1;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
