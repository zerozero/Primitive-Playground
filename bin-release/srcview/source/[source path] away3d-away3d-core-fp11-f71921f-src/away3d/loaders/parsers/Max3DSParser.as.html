<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Max3DSParser.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">loaders</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parsers</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">arcane</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">base</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Geometry</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">base</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SubGeometry</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">entities</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Mesh</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">library</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">assets</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BitmapDataAsset</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">loaders</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">misc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ResourceDependency</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">materials</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BitmapMaterial</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tools</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TextureUtils</span>;

    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BitmapData</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Matrix3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Vector3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">net</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">URLRequest</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ByteArray</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Endian</span>;

    <span class="ActionScriptReserved">use</span> <span class="ActionScriptReserved">namespace</span> <span class="ActionScriptDefault_Text">arcane</span>;
    
    <span class="ActionScriptASDoc">/**
     * File loader for the 3DS file format.
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">Max3DSParser</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">ParserBase</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">LIMIT</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 64998;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_startedParsing</span> : <span class="ActionScriptDefault_Text">Boolean</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_mesh</span>:<span class="ActionScriptDefault_Text">Mesh</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_meshList</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">MaterialRef</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">MaterialRef</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_materialList</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">MaterialDefinition</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">MaterialDefinition</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_geometry</span>:<span class="ActionScriptDefault_Text">Geometry</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_materialName</span>:<span class="ActionScriptDefault_Text">String</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_activeData</span>:<span class="ActionScriptDefault_Text">FaceData</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_indv</span>:<span class="ActionScriptDefault_Text">uint</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ind</span>:<span class="ActionScriptDefault_Text">uint</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_induv</span>:<span class="ActionScriptDefault_Text">uint</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_dependencyCount</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_transform</span>:<span class="ActionScriptDefault_Text">Matrix3D</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_holder</span>:<span class="ActionScriptDefault_Text">Vector3D</span>;
        
        
        <span class="ActionScriptComment">//&gt;----- Color Types --------------------------------------------------------
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">AMBIENT</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"ambient"</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">DIFFUSE</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"diffuse"</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">SPECULAR</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"specular"</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">GLOSS</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"gloss"</span>;
        
        <span class="ActionScriptComment">//&gt;----- Main Chunks --------------------------------------------------------
</span>        
        <span class="ActionScriptComment">//private const PRIMARY:int = 0x4D4D;
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">EDIT3DS</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0x3D3D;  <span class="ActionScriptComment">// Start of our actual objects
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">KEYF3DS</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0xB000;  <span class="ActionScriptComment">// Start of the keyframe information
</span>        
        <span class="ActionScriptComment">//&gt;----- General Chunks -----------------------------------------------------
</span>        
        <span class="ActionScriptComment">//private const VERSION:int = 0x0002;
</span>        <span class="ActionScriptComment">//private const MESH_VERSION:int = 0x3D3E;
</span>        <span class="ActionScriptComment">//private const KFVERSION:int = 0x0005;
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">COLOR_F</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0x0010;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">COLOR_RGB</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0x0011;
        <span class="ActionScriptComment">//private const LIN_COLOR_24:int = 0x0012;
</span>        <span class="ActionScriptComment">//private const LIN_COLOR_F:int = 0x0013;
</span>        <span class="ActionScriptComment">//private const INT_PERCENTAGE:int = 0x0030;
</span>        <span class="ActionScriptComment">//private const FLOAT_PERC:int = 0x0031;
</span>        <span class="ActionScriptComment">//private const MASTER_SCALE:int = 0x0100;
</span>        <span class="ActionScriptComment">//private const IMAGE_FILE:int = 0x1100;
</span>        <span class="ActionScriptComment">//private const AMBIENT_LIGHT:int = 0X2100;
</span>        
        <span class="ActionScriptComment">//&gt;----- Object Chunks -----------------------------------------------------
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MESH</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0x4000;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MESH_OBJECT</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0x4100;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MESH_VERTICES</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0x4110;
        <span class="ActionScriptComment">//private const VERTEX_FLAGS:int = 0x4111;
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MESH_FACES</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0x4120;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MESH_MATER</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0x4130;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MESH_TEX_VERT</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0x4140;
        <span class="ActionScriptComment">//private const MESH_XFMATRIX:int = 0x4160;
</span>        <span class="ActionScriptComment">//private const MESH_COLOR_IND:int = 0x4165;
</span>        <span class="ActionScriptComment">//private const MESH_TEX_INFO:int = 0x4170;
</span>        <span class="ActionScriptComment">//private const HEIRARCHY:int = 0x4F00;
</span>        
        <span class="ActionScriptComment">//&gt;----- Material Chunks ---------------------------------------------------
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MATERIAL</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0xAFFF;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MAT_NAME</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0xA000;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MAT_AMBIENT</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0xA010;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MAT_DIFFUSE</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0xA020;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MAT_SPECULAR</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0xA030;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MAT_SHININESS</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0xA040;
        <span class="ActionScriptComment">//private const MAT_FALLOFF:int = 0xA052;
</span>        <span class="ActionScriptComment">//private const MAT_EMISSIVE:int = 0xA080;
</span>        <span class="ActionScriptComment">//private const MAT_SHADER:int = 0xA100;
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MAT_TEXMAP</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0xA200;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MAT_TEXFLNM</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0xA300;
        <span class="ActionScriptComment">//private const OBJ_LIGHT:int = 0x4600;
</span>        <span class="ActionScriptComment">//private const OBJ_CAMERA:int = 0x4700;
</span>        
        <span class="ActionScriptComment">//&gt;----- KeyFrames Chunks --------------------------------------------------
</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">ANIM_HEADER</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0xB00A;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">ANIM_OBJ</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0xB002;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">ANIM_NAME</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0xB010;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">ANIM_PIVOT</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0xB013;
        <span class="ActionScriptComment">//private const ANIM_POS:int = 0xB020;
</span>        <span class="ActionScriptComment">//private const ANIM_ROT:int = 0xB021;
</span>        <span class="ActionScriptComment">//private const ANIM_SCALE:int = 0xB022;
</span>        
        
        <span class="ActionScriptASDoc">/**
         * Max3DSParser provides a parser for the 3ds data type.
         * @param uri The url or id of the data or file to be parsed.
         * @param extra The holder for extra contextual data that the parser might need.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">Max3DSParser</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">super</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ParserDataFormat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BINARY</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Indicates whether or not a given file extension is supported by the parser.
         * @param extension The file extension of a potential file to be parsed.
         * @return Whether or not the given file type is supported.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">supportsType</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">extension</span> : <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">extension</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">extension</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toLowerCase</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">extension</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">"3ds"</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Tests whether a data block can be parsed by the parser.
         * @param data The data block to potentially be parsed.
         * @return Whether or not the given data is supported.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">supportsData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span> : <span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Boolean</span> 
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ba</span> : <span class="ActionScriptDefault_Text">ByteArray</span>;
            
            <span class="ActionScriptDefault_Text">ba</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ByteArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">ba</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span> <span class="ActionScriptOperator">=</span> 0;
            
            <span class="ActionScriptComment">// "Magic" two first bytes of 3DS are 0x4d4d
</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ba</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readShort</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> 0x4d4d<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         */</span>
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">resolveDependency</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">resourceDependency</span>:<span class="ActionScriptDefault_Text">ResourceDependency</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">resourceDependency</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">assets</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">!=</span> 1<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">resource</span>:<span class="ActionScriptDefault_Text">BitmapDataAsset</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">resourceDependency</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">assets</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">BitmapDataAsset</span>;
            <span class="ActionScriptDefault_Text">_dependencyCount</span><span class="ActionScriptOperator">--</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">resource</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">resource</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bitmapData</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">isBitmapDataValid</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">resource</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bitmapData</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">setSourceToMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">resourceDependency</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">resource</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bitmapData</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_dependencyCount</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">buildMaterials</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         */</span>
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">resolveDependencyFailure</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">resourceDependency</span>:<span class="ActionScriptDefault_Text">ResourceDependency</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">resourceDependency</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">assets</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">!=</span> 1<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">resource</span>:<span class="ActionScriptDefault_Text">BitmapDataAsset</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">resourceDependency</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">assets</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">BitmapDataAsset</span>;
            <span class="ActionScriptDefault_Text">_dependencyCount</span><span class="ActionScriptOperator">--</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_dependencyCount</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">buildMaterials</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">proceedParsing</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_startedParsing</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_startedParsing</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">endian</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Endian</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">LITTLE_ENDIAN</span>;
                
                <span class="ActionScriptComment">//first chunk is always the primary, so we simply read it and parse it
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">readChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">parse3DS</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">parsingFailure</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">buildMeshGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_dependencyCount</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">buildMaterials</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">PARSING_DONE</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">MORE_TO_PARSE</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">MORE_TO_PARSE</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Read id and length of 3ds chunk
         * @param chunk 
         */</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">readChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">try</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readUnsignedInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">=</span> 6;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">catch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>:<span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">parsingFailure</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"3DS file probably damaged"</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Skips past a chunk. If we don't understand the meaning of a chunk id,
         * we just skip past it.
         * @param chunk
         */</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">skipChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span>;
            <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Read the base 3DS object.
         * @param chunk
         */</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parse3DS</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">subChunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">readChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">EDIT3DS</span>:
                        <span class="ActionScriptDefault_Text">parseEdit3DS</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">KEYF3DS</span>:
                        <span class="ActionScriptDefault_Text">parseKey3DS</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">default</span>:
                        <span class="ActionScriptDefault_Text">skipChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Read the Edit chunk
         * @param chunk
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseEdit3DS</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">subChunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">readChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">MATERIAL</span>:
                        <span class="ActionScriptDefault_Text">parseMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">MESH</span>:
                        <span class="ActionScriptDefault_Text">readMeshName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">parseMesh</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptComment">/*todo
                        if (centerMeshes) {
                        _geometry.maxX = -Infinity;
                        _geometry.minX = Infinity;
                        _geometry.maxY = -Infinity;
                        _geometry.minY = Infinity;
                        _geometry.maxZ = -Infinity;
                        _geometry.minZ = Infinity;
                        for each (var _vertex:Vertex in _verticesDictionary) {
                        if (_geometry.maxX &lt; _vertex._x)
                        _geometry.maxX = _vertex._x;
                        if (_geometry.minX &gt; _vertex._x)
                        _geometry.minX = _vertex._x;
                        if (_geometry.maxY &lt; _vertex._y)
                        _geometry.maxY = _vertex._y;
                        if (_geometry.minY &gt; _vertex._y)
                        _geometry.minY = _vertex._y;
                        if (_geometry.maxZ &lt; _vertex._z)
                        _geometry.maxZ = _vertex._z;
                        if (_geometry.minZ &gt; _vertex._z)
                        _geometry.minZ = _vertex._z;
                        }
                        }*/</span>
                        
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">default</span>:
                        <span class="ActionScriptDefault_Text">skipChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Read the Key chunk
         * @param chunk
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseKey3DS</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">subChunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">readChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">ANIM_HEADER</span>:
                        <span class="ActionScriptDefault_Text">testChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">ANIM_OBJ</span>:
                        <span class="ActionScriptDefault_Text">parseAnimation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">default</span>:
                        <span class="ActionScriptDefault_Text">skipChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">testChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span>;
            <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">//*****MATERIALS *******
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">buildMaterials</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">md</span>:<span class="ActionScriptDefault_Text">MaterialDefinition</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m</span>:<span class="ActionScriptDefault_Text">Mesh</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">matLength</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_materialList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">uint</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span>:<span class="ActionScriptDefault_Text">uint</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">matref</span>:<span class="ActionScriptDefault_Text">MaterialRef</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bmMaterial</span>:<span class="ActionScriptDefault_Text">BitmapMaterial</span>;
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">_meshList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;<span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">matref</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_meshList</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">=</span> 0;<span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">matLength</span>;<span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">md</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_materialList</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">md</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">materialID</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">matref</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">materialID</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">bmMaterial</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">BitmapMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">matref</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mesh</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">material</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">bmMaterial</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bitmapData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">md</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bitmapData</span>;
                        <span class="ActionScriptComment">/* to do split
                        bmMaterial.ambientMethod = md.ambientColor;
                        bmMaterial.specularMethod = md.specularColor;
                        bmMaterial.diffuseMethod = md.diffuseColor;
                        //need normalize probably
                        bmMaterial.gloss = md.gloss;
                        bmMaterial.specular = md.specular;
                        */</span>
                        <span class="ActionScriptDefault_Text">_meshList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">splice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">i</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>             
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setSourceToMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">id</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">bitmapData</span>:<span class="ActionScriptDefault_Text">BitmapData</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">md</span>:<span class="ActionScriptDefault_Text">MaterialDefinition</span>;
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">_materialList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;<span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">md</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_materialList</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">md</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">materialID</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">md</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bitmapData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bitmapData</span>;
                    <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_dependencyCount</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">buildMaterials</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">subChunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">readChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">MAT_NAME</span>:
                        <span class="ActionScriptDefault_Text">readMaterialName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">MAT_AMBIENT</span>:
                        <span class="ActionScriptDefault_Text">readColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">AMBIENT</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">MAT_DIFFUSE</span>:
                        <span class="ActionScriptDefault_Text">readColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">DIFFUSE</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">MAT_SPECULAR</span>:
                        <span class="ActionScriptDefault_Text">readColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SPECULAR</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">MAT_SHININESS</span>:
                        <span class="ActionScriptDefault_Text">readColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">GLOSS</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">MAT_TEXMAP</span>:
                        <span class="ActionScriptDefault_Text">parseMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">MAT_TEXFLNM</span>:
                        <span class="ActionScriptDefault_Text">readTextureFileName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">default</span>:
                        <span class="ActionScriptDefault_Text">skipChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">readMaterialName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_materialName</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">readASCIIZString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">readTextureFileName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">filename</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">readASCIIZString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ext</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">filename</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">filename</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">-</span>4<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">filename</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toLowerCase</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ext</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">".jpg"</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">ext</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">".png"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">addDependency</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_materialName</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URLRequest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">filename</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">_dependencyCount</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">md</span>:<span class="ActionScriptDefault_Text">MaterialDefinition</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_materialList</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_materialList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">defaultmap</span>:<span class="ActionScriptDefault_Text">BitmapData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">defaultBitmapData</span>;
            <span class="ActionScriptDefault_Text">md</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">materialID</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_materialName</span>;
            <span class="ActionScriptDefault_Text">md</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">url</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">filename</span>;
            <span class="ActionScriptDefault_Text">md</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bitmapData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">defaultmap</span>;
            
            <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Read the Mesh Material chunk
         * @param chunk
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">readMeshMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">materialRef</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">readASCIIZString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_meshList</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_meshList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">materialID</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">materialRef</span>;
            
            <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">materialRef</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">+</span>1;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">numFaces</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0;
            
            <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> 2;
            <span class="ActionScriptComment">// to do look at multiple materials
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">materialid</span>:<span class="ActionScriptDefault_Text">uint</span>;
            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">numFaces</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">materialid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> 2;
                <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">readColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">type</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">readChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">COLOR_RGB</span>:
                    <span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">readColorRGB</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">COLOR_F</span>:
                    <span class="ActionScriptComment">//trace("COLOR_F not implemented yet");
</span>                    <span class="ActionScriptDefault_Text">skipChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptReserved">default</span>:
                    <span class="ActionScriptComment">//trace("unknown ambient color format");
</span>                    <span class="ActionScriptDefault_Text">skipChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">md</span>:<span class="ActionScriptDefault_Text">MaterialDefinition</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">MaterialDefinition</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_materialList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">md</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//type (shading) md.materialType = "SHADING_MATERIAL" : "COLOR_MATERIAL";
</span>            
            <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">type</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">AMBIENT</span>:
                    <span class="ActionScriptDefault_Text">md</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ambient</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
                    <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">DIFFUSE</span>:
                    <span class="ActionScriptDefault_Text">md</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">diffuse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
                    <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">SPECULAR</span>:
                    <span class="ActionScriptDefault_Text">md</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">specular</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
                    <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">GLOSS</span>:
                    <span class="ActionScriptDefault_Text">md</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">gloss</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">readColorRGB</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">color</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0;
            
            <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 3<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readUnsignedByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">color</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pow</span><span class="ActionScriptBracket/Brace">(</span>0x100<span class="ActionScriptOperator">,</span> 2<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span><span class="ActionScriptOperator">++</span>;
                <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">color</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">//*****ANIMATION *******
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseAnimation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">subChunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">readChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">ANIM_NAME</span>:
                        <span class="ActionScriptDefault_Text">readAnimationName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">ANIM_PIVOT</span>:
                        <span class="ActionScriptDefault_Text">readPivot</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptComment">/*
                    case ANIM_POS:
                    readPosTrack(subChunk);
                    break;
                    case ANIM_ROT:
                    readRotTrack(subChunk);
                    break;
                    case ANIM_SCALE:
                    readScaleTrack(subChunk);
                    break;
                    */</span>
                    <span class="ActionScriptReserved">default</span>:
                        <span class="ActionScriptDefault_Text">skipChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">readAnimationName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">meshref</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">readASCIIZString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">meshref</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">+</span> 1;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">flags1</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">flags1</span>;
            <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> 2;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">flags2</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">flags2</span>;
            <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> 2;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">heirarchy</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">heirarchy</span>;
            <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> 2;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">readPivot</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">x</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">z</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_mesh</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">appendTranslation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">z</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">/*
        private function readPosTrack(chunk:Chunk3ds):void
        {
        _byteData.position += 10;
        
        var numFrames:uint = _byteData.readUnsignedShort();
        
        _byteData.position += 2;
        
        for (var i:int = 0; i &lt; numFrames; ++i)
        {
        _byteData.readUnsignedShort();
        _byteData.readUnsignedInt();
        var x:Number = _byteData.readFloat();
        var y:Number = _byteData.readFloat();
        var z:Number = _byteData.readFloat();
        _mesh.transform.appendTranslation(-z, y, -x);
        }
        
        chunk.bytesRead = chunk.length;
        }
        
        private function readRotTrack(chunk:Chunk3ds):void
        {
        _byteData.position += 10;
        
        var numFrames:uint = _byteData.readUnsignedShort();
        
        _byteData.position += 2;
        
        for (var i:int = 0; i &lt; numFrames; ++i)
        {
        _byteData.readUnsignedShort();
        _byteData.readUnsignedInt();
        var rot:Number = _byteData.readFloat()*180/Math.PI;
        var x:Number = _byteData.readFloat();
        var y:Number = _byteData.readFloat();
        var z:Number = _byteData.readFloat();
        _mesh.transform.prependRotation(rot, new Vector3D(-z, y, -x));
        }
        
        chunk.bytesRead = chunk.length;
        }
        
        private function readScaleTrack(chunk:Chunk3ds):void
        {
        _byteData.position += 10;
        
        var numFrames:uint = _byteData.readUnsignedShort();
        
        _byteData.position += 2;
        
        for (var i:int = 0; i &lt; numFrames; ++i)
        {
        _byteData.readUnsignedShort();
        _byteData.readUnsignedInt();
        var x:Number = _byteData.readFloat();
        var y:Number = _byteData.readFloat();
        var z:Number = _byteData.readFloat();
        _mesh.transform.prependScale(-z, y, -x);
        }
        
        chunk.bytesRead = chunk.length;
        }
        */</span>
        
        <span class="ActionScriptComment">//*****GEOMETRY *******
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseMesh</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">subChunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">readChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">MESH_OBJECT</span>:
                        <span class="ActionScriptDefault_Text">parseMesh</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">MESH_VERTICES</span>:
                        <span class="ActionScriptDefault_Text">readMeshVertices</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">MESH_FACES</span>:
                        <span class="ActionScriptDefault_Text">readMeshFaces</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">parseMesh</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">MESH_MATER</span>:
                        <span class="ActionScriptDefault_Text">readMeshMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">MESH_TEX_VERT</span>:
                        <span class="ActionScriptDefault_Text">readMeshTexVert</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">default</span>:
                        <span class="ActionScriptDefault_Text">skipChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">subChunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">buildMeshGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vertices</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_activeData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">vertices</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">indices</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_activeData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">indices</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uvs</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_activeData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">uvs</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vertLength</span>:<span class="ActionScriptDefault_Text">uint</span> ;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sub_geom</span>:<span class="ActionScriptDefault_Text">SubGeometry</span>;
            <span class="ActionScriptComment">//Todo check on limit
</span>            <span class="ActionScriptComment">//for(i=0;i&lt;subGeomsData.length;i+=3){
</span>            <span class="ActionScriptDefault_Text">sub_geom</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">SubGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_geometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addSubGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sub_geom</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">sub_geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">updateVertexData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">sub_geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">updateIndexData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">indices</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">sub_geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">updateUVData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//}
</span>            
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">readMeshName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_ind</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">buildMeshGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">meshName</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">readASCIIZString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_geometry</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Geometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_mesh</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Mesh</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_geometry</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_mesh</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">meshName</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bitmapMaterial</span>:<span class="ActionScriptDefault_Text">BitmapMaterial</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BitmapMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">defaultBitmapData</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">bitmapMaterial</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">meshName</span>;
            <span class="ActionScriptDefault_Text">_mesh</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">material</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bitmapMaterial</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">newRef</span>:<span class="ActionScriptDefault_Text">MaterialRef</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">MaterialRef</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">newRef</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mesh</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_mesh</span>;
            <span class="ActionScriptDefault_Text">newRef</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">materialID</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_materialName</span>;
            <span class="ActionScriptDefault_Text">_meshList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">newRef</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_activeData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">FaceData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_indv</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_ind</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_induv</span> <span class="ActionScriptOperator">=</span> 0;
            
            <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">meshName</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">+</span> 1;
            
            <span class="ActionScriptComment">// TODO: I think this is happening too early. Make sure this doesn't
</span>            <span class="ActionScriptComment">// happen until after the entire mesh data has been parsed.
</span>            <span class="ActionScriptDefault_Text">finalizeAsset</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_mesh</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">readMeshVertices</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">numVerts</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0;
            
            <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> 2;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_holder</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_holder</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span>0<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_transform</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Matrix3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_transform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">prependRotation</span><span class="ActionScriptBracket/Brace">(</span>90<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_holder</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">numVerts</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_holder</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_holder</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_holder</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">_holder</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_transform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">deltaTransformVector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_holder</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_activeData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_indv</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_holder</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptDefault_Text">_activeData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_indv</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_holder</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptDefault_Text">_activeData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_indv</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_holder</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span>;
                
                <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> 12;
                <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">readMeshFaces</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">numFaces</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptComment">//var bVisible:Boolean;
</span>            
            <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> 2;
            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">numFaces</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//invert faces for away
</span>                <span class="ActionScriptDefault_Text">_activeData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">indices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_ind</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_activeData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">indices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_ind</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_activeData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">indices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_ind</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">//do we need this? we skip for now
</span>                <span class="ActionScriptComment">//bVisible = _byteData.readUnsignedShort() as Boolean;
</span>                <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> 8;
                <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">readMeshTexVert</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>:<span class="ActionScriptDefault_Text">Chunk3ds</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">numUVs</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0;
            
            <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> 2;
            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">numUVs</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_activeData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_induv</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_activeData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_induv</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 1<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">_byteData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bytesRead</span> <span class="ActionScriptOperator">+=</span> 8;
                <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Reads a null-terminated ascii string out of a byte array.
         * @param data The byte array to read from.
         * @return The string read, without the null-terminating character.
         */</span>        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">readASCIIZString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span>:<span class="ActionScriptDefault_Text">ByteArray</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">l</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tempByteArray</span>:<span class="ActionScriptDefault_Text">ByteArray</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ByteArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0;
            
            <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">l</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">tempByteArray</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">asciiz</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">""</span>;
            <span class="ActionScriptDefault_Text">tempByteArray</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">tempByteArray</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">asciiz</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">fromCharCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tempByteArray</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">asciiz</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">entities</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Mesh</span>;

<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BitmapData</span>;

<span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">Chunk3ds</span>
<span class="ActionScriptBracket/Brace">{</span>    
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">id</span>:<span class="ActionScriptDefault_Text">int</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">length</span>:<span class="ActionScriptDefault_Text">int</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bytesRead</span>:<span class="ActionScriptDefault_Text">int</span>;     
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">MaterialDefinition</span>
<span class="ActionScriptBracket/Brace">{</span>

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">materialID</span>:<span class="ActionScriptDefault_Text">String</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">url</span>:<span class="ActionScriptDefault_Text">String</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bitmapData</span>:<span class="ActionScriptDefault_Text">BitmapData</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ambient</span>:<span class="ActionScriptDefault_Text">Number</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">diffuse</span>:<span class="ActionScriptDefault_Text">Number</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">specular</span>:<span class="ActionScriptDefault_Text">Number</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">gloss</span>:<span class="ActionScriptDefault_Text">Number</span>;
    <span class="ActionScriptComment">//public var materialType:String;
</span><span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">FaceData</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vertices</span> : <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uvs</span> : <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">indices</span> : <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">MaterialRef</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mesh</span>:<span class="ActionScriptDefault_Text">Mesh</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">materialID</span>:<span class="ActionScriptDefault_Text">String</span>;
<span class="ActionScriptBracket/Brace">}</span>

</pre></body>
</html>
